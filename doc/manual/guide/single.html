<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <title>Rabbitmq Native Plugin 0.1</title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8" />
        <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8" />
    <script type="text/javascript">
function addJsClass(el) {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
    </head>

    <body class="body" onload="addJsClass();">
        <div id="navigation">
            <ul>
                <li>
                    <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                        <a href="../guide/index.html" class="button">Table of contents</a>
                        <div id="nav-summary-childs" style="display:none;">
                            
                            <div class="toc-item" style="margin-left:0"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#configuration"><strong>2</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0"><a href="#consuming"><strong>3</strong><span>Consuming Messages</span></a></div>
                            
                        </div>
                    </div>
                </li>
                <li class="separator selected">
                    <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
                </li>
            </ul>
        </div>
        <div id="header">
            <div class="images clearfix">
                
                
            </div>
            <p>The native RabbitMQ Grails plugin wraps RabbitMQ consumer funcionality around Grails services.</p>
        </div>


        <table id="colset" border="0" cellpadding="0" cellspacing="0">
            <tr>
                <td id="col1">
                    <div id="main" class="corner-all">

                        <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                        <div class="project">
                            <h1>Rabbitmq Native Plugin - Reference Documentation</h1>
                            <p><strong>Authors:</strong> Bud Byrd</p>
                            <p><strong>Version:</strong> 0.1</p>
                            
                        </div>

                        
                        <div id="table-of-content">
                            <h2>Table of Contents</h2>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#introduction"><strong>1</strong><span>Introduction</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#migrating"><strong>1.1</strong><span>Migrating From The Official RabbitMQ Plugin</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#changelog"><strong>1.2</strong><span>Changelog</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#configuration"><strong>2</strong><span>Configuration</span></a></div>
                            
                            <div class="toc-item" style="margin-left:0px"><a href="#consuming"><strong>3</strong><span>Consuming Messages</span></a></div>
                            
                            <div class="toc-item" style="margin-left:10px"><a href="#handlers"><strong>3.1</strong><span>Message Handlers</span></a></div>
                            
                            <div style="clear:both" ></div>
                        </div>
                        
                        

<h1 id="introduction">1 Introduction</h1>
The RabbitMQ Native plugin for Grails provides RabbitMQ integration using the Java libraries provided by the RabbitMQ project.
It provides easy configuration of exchanges and queues via a project's configuration, simple configuration of consumers, and
a convenience class to easily send messages.<p class="paragraph"/>This plugin strives to provide an easy convention to follow to quickly begin consuming messages, but still provide easy
access to the underlying layer to allow users of this plugin to do whatever they need to do outside of those conventions.
It also provides a powerful message body converter system that allows the user to quickly write and plug in converters for
custom data types.<p class="paragraph"/>This guide details the configuration of the plugin, and may not fully explain the use and conventions of the RabbitMQ services
or its Java library.  More information can be found in their <a href="http://www.rabbitmq.com/api-guide.html" target="blank">Java API guide</a> and
<a href="http://www.rabbitmq.com/releases/rabbitmq-java-client/v3.1.5/rabbitmq-java-client-javadoc-3.1.5" target="blank">JavaDoc</a>.<p class="paragraph"/>


<h2 id="migrating">1.1 Migrating From The Official RabbitMQ Plugin</h2>
This plugin was created to provide closer integration with the native RabbitMQ Java library, and remove the Spring Framework
RabbitMQ layer utilized by the official Grails RabbitMQ plugin. This plugin follows many of its conventions, but it also
does some things very differently. If you are migrating from the official plugin to this one, please keep in mind that while
many things may work similarly, there are small changes that need to be accounted for. Also note that not all features of
the official plugin are present in this one, and visa versa.



<h2 id="changelog">1.2 Changelog</h2>
<h3>Version 0.1 - 10/17/2013</h3>
<ul class="star">
<li>Code complete/experimental release.</li>
</ul><p class="paragraph"/>


<h1 id="configuration">2 Configuration</h1>
Configuration of the connection to the RabbitMQ server is done in your project's <code>grails-app/conf/Config.groovy</code> file.<p class="paragraph"/>Currently this plugin has only a few configuration parameters, all of which are used in the connection to the RabbitMQ server.
A bare minimum configuration example looks like:<p class="paragraph"/><div class="code"><pre>rabbitmq &#123;
    connection &#123;
        host = 'example.com'
        username = 'foo'
        password = 'bar'
    &#125;
&#125;</pre></div><p class="paragraph"/>The following table enumerates all the configuration options available to the connection configuration:
<table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Configuration Property</strong></th><th><strong class="bold">Required</strong></th><th><strong class="bold">Description</strong></th><th><strong class="bold">Type</strong></th><th><strong class="bold">Default</strong></th></tr><tr class="table-odd"><td>host</td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Hostname or IP address of the RabbitMQ server to connect to.</td><td>String</td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td>username</td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Username to log into the RabbitMQ server with.</td><td>String</td><td> <em class="italic">none</em> </td></tr><tr class="table-odd"><td>password</td><td><img border="0" class="center" src="../img//bullet_red.png"></img></td><td>Password to log into the RabbitMQ server with.</td><td>String</td><td> <em class="italic">none</em> </td></tr><tr class="table-even"><td>port</td><td>&#160;</td><td>Port to connect to the RabbitMQ server with.</td><td>Integer</td><td>5672</td></tr><tr class="table-odd"><td>virtualHost</td><td>&#160;</td><td>Name of the virtual host to connect to the RabbitMQ server with.</td><td>String</td><td> <em class="italic">none</em> </td></tr></table>



<h1 id="consuming">3 Consuming Messages</h1>
Consuming messages is accomplished by creating a message consumer class. Consumer classes are placed into the
<code>grails-app/rabbit-consumers</code>, and must end with <code>Consumer.groovy</code>. These classes are Spring beans, meaning
that they can inject other Spring beans such as services, the <code>grailsApplication</code> instance, etc. Each consumer
class must be configured in a certain way. If there is a misconfiguration in a consumer, the plugin will log
an error stating so and not register the consumer to any queues.



<h2 id="handlers">3.1 Message Handlers</h2>
One of the requirements for a consumer to be registered to the RabbitMQ server is that a message handler be declared
in the consumer class. The message handler is the mechanism by which messages are consumed.<p class="paragraph"/><h3>Basic Usage</h3>
<ol>
<ol>
<ol>
<li>TODO: link to MessageContext###</li>
</ol></ol></ol><p class="paragraph"/>In its most basic form, a message handler method takes in the body of the received message, and a <code>MessageContext</code>
object that contains the message parameters received from the RabbitMQ server, along with the consumer's channel
that the handler should send messages through.<p class="paragraph"/>This is the most generic form of a message handler:
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/>class ExampleConsumer &#123;
    // ...<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // Do work
    &#125;
&#125;</pre></div><p class="paragraph"/><h3>Typed Message Handlers</h3>
The logic surrounding the message consumer classes will by default attempt to intelligently convert the body of
the received message from a byte array to a converted type, such as a String. Before routing the message to the
consumer and handler, the plugin will run through a list of converters that will attempt to convert the message,
and if the conversion was successful, determine if an appropriate handler has been defined.<p class="paragraph"/>For example, consider this JSON blob:
<div class="code"><pre>&#123;<span class="java&#45;quote">"foo"</span>:<span class="java&#45;quote">"bar"</span>,<span class="java&#45;quote">"hi"</span>:<span class="java&#45;quote">"there"</span>&#125;</pre></div><p class="paragraph"/>If the above message is received, the converter for the Map class type will convert the byte array to a Map
of the JSON data. If a valid handler for the Map type is defined, the handler will receive the converted JSON
so that the handler does not need to handle the conversion.<p class="paragraph"/>The following handlers would accept the converted Map:
<div class="code"><pre><span class="java&#45;keyword">package</span> com.example<p class="paragraph"/>class ExampleConsumer &#123;
    // ...<p class="paragraph"/>    def handleMessage(Map body, MessageContext context) &#123;
        // Do work
    &#125;<p class="paragraph"/>    def handleMessage(def body, MessageContext context) &#123;
        // Since def is a <span class="java&#45;keyword">generic</span> type (<span class="java&#45;object">Object</span>)
    &#125;
&#125;</pre></div><p class="paragraph"/><blockquote class="note">
If a converter was successfully able to convert the message body, but no handler was defined to handle the
class type, other converters will get a chance to convert the message body. In the above example, if only
a handler for the String type was defined, the handler will receive the JSON blob as a String.<p class="paragraph"/>If no converter is able to convert the message body, the plugin will fall back to passing the handler the raw
byte array received from the RabbitMQ server.
</blockquote>
<blockquote class="warning">
If no handler is defined that can handle the received message (including the raw byte array), an error will
be logged and the message will be rejected.
</blockquote><p class="paragraph"/>TODO: link to converters<p class="paragraph"/>The plugin has built-in converters for <code>Integer</code>, <code>Map</code>, <code>List</code>, and <code>String</code> types. The plugin allows users
to define their own converters to convert other object types, which will be discussed later in this guide.<p class="paragraph"/>

                    </div>
                </td>
                <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                    <div class="menu-block"><h1 class="menu-title" onclick="toggleRef(this.parentNode.childNodes[1])">Items</h1><div class="menu-sub">
                        
                        
                        <div class="menu-item"><a href="../ref/Items/reference.html">reference</a>
                        </div>
                        
                        </div>
                    </div>
                    
                </div>
            </div>
        </td>
            </tr>
        </table>

        <div id="footer">
            
            
        </div>



<script type="text/javascript" src="../js/docs.js"></script>

    </body>
</html>
